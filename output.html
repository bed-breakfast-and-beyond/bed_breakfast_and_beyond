<!DOCTYPE html>
<html>
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8">
 
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=AIzaSyATIo38F3Q8qEhyMq-pS_AZmViqEThMOh8&amp;sensor=false"
            type="text/javascript"></script>
<script src="json2.js"></script>
<link href="./css/default.css" rel="stylesheet" type="text/css" />

<!-- Loads Features -->
<script src="comparator.js" type="text/javascript"></script>
<script src="suggestedlocation.js" type="text/javascript"></script>
<script src="yelp.js" type="text/javascript"></script>
<script src="displaymap.js" type="text/javascript" ></script>

<script type="text/javascript">
//Handles scrolling event for comparator
$(window).on('scroll', function () {
	var scrollTop = $(window).scrollTop(),
		elementOffset = $('#div-my-tabl').offset().top,
		distance = (elementOffset - scrollTop);
		
	var comp = document.getElementById('comparator');
	if(distance < 0 ){
		comp.style.position = 'fixed';
		comp.style.width = '30%';
	}
	else{
		comp.style.position = 'absolute';
		comp.style.width = '40%';
	}
	});
    
    function loadListing(url, index){
        var iframe = document.getElementById('listing_details');
        iframe.setAttribute('src', url);
        currentIndex = index;
		$("body").css('overflow','hidden');
		displayMap(null,resultJSON.searchresult[index].address);
        $('#current_listing').attr('href',url);
    }
	function hideListing(){
		
		$("body").css('overflow','auto');
		$('.overlay').attr('display','none');
		//Grab our current Url
		var url = window.location.toString();
		
		window.location = '#';
		return false;
		
	}
	//Global variables for the result JSON object and comparator class
	var resultJSON;
	var comparator;
    var currentIndex;
</script>
</head>
<body onunload="GUnload()">

    <div id="top">
		<div id="header">
			<h2 id="title">Bed Breakfast &amp; Beyond</h2>
			<a href="./index.html"> Enter another search </a>
		</div>

		<div id="result-container" style="position:relative">
			<div id="comparator">Comparator</div>
			<div id="div-my-tabl"></div>
		</div>

		<div id="right-column">
		<h2 align="center">Yelp Feature</h2>
		<div id="div-my-tab2"></div><BR>
		<BR>

		</div>
	</div>
    
    <div id="overlay" class="overlay">
		<div class="overlay-container">
			<iframe id="listing_details" src="./loading.gif"></iframe>
			<div id="map_canvas" style="float:right"></div>
			<div class="listing_menu">
                <a id="current_listing" href="" target="_blank">Open in new Window</a>
				<button onclick="enterComparator(resultJSON, currentIndex, document.getElementById(&quot;compare_form&quot;));">Compare this listing</button>
				<button onclick="hideListing();">Close</button>
			</div>
		</div>
    </div>
    <form id="compare_form" style="display:none;"></form>
<script>

//Fills page with results from the JSON string
$("document").ready(function() {
	comparator = new Comparator(document.getElementById('comparator'), document.getElementById('div-my-tabl'));
	$.getJSON("./results.json", function(data) {
		
        resultJSON = data;
		$listings = data['searchresult'];
		var results = document.getElementById('div-my-tabl');
		var resultTable = document.createElement('table');
		results.appendChild(resultTable);
		$.each($listings, function(i, item) {
			var cell = document.createElement('td');
			var newDiv = document.createElement('div');
			newDiv.setAttribute('index', i);
			var innerHTML = '<div class=\"list\" style=\"float:left\"><img class = \"pic\" src=\"' + item.image + '\"/></div>'; 

    innerHTML += 	'<h2 style=\"margin:0\" ><a href=\"#overlay\" onclick=\"loadListing(&quot;https://' + item.url + '&quot;,' + i +')\">' + item.name + '</a></h2>';
			innerHTML += 	'<p style=\"margin:0\">     ' + item.room + '<br>' + item.currency + '</p>';
			//innerHTML += 	'<div class=\"checkitem\" style=\"float:right\">' +
			//					'<input type=\"checkbox\" onclick=\"comparator.addToCompare(this,resultJSON.searchresult)\"' +
			//					'index=\"' + i + '\"/>Compare' +
			//				'</div>';
			newDiv.innerHTML = innerHTML;
			cell.appendChild(newDiv);
			var tableRow = document.createElement('tr');
			tableRow.appendChild(cell);
			resultTable.appendChild(tableRow);
		});
		//Display Suggested Location
		displaySuggested(data.suggested,document.getElementById('header'));
		//Display Google Map
		//displayMap(data['searchresult'],data['place']);
	});
	
	loadYelpResults(document.getElementById('div-my-tab2'));
});
</script>


</body></html>