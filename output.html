<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<style type="text/css">
#div-my-tabl {
	font-family: Arial, Helvetica, sans-serif;
	background:#FFFFFF;
	
}

#title{
	text-align:center;
	font-family:Tahoma, Geneva, sans-serif;
	font-size:36px;
	
	outline-color:#090;
	color:#60C;
	}
	
#comparator{
	display:none;
	position:absolute;
	width:50%;
	top:0px;
	
	
}
#result-container{
	width:85%;
	margin:0px auto;
}

td[id *="1"]{color:#F30;font-size:24px;font-stretch:semi-expanded;font-style:oblique;}
</style>

<script type="text/javascript">
//Handles scrolling event for comparator
$(window).on('scroll', function () {
	var scrollTop = $(window).scrollTop(),
		elementOffset = $('#div-my-tabl').offset().top,
		distance = (elementOffset - scrollTop);
		
	var comp = document.getElementById('comparator');
	if(distance < 0 ){
		comp.style.position = 'fixed';
		comp.style.width = '40%';
	}
	else{
		comp.style.position = 'absolute';
		comp.style.width = '50%';
	}
	});
	
	function showComparator(){
		var comp = document.getElementById('comparator');
		comp.style.display = 'block';
		document.getElementById('div-my-tabl').style.marginLeft = '50%';
	}
	
	function hideComparator(){
		var comp = document.getElementById('comparator');
		comp.style.display = 'none';
		document.getElementById('div-my-tabl').style.marginLeft = '0px';
	}
	
	
	function addToCompare(currentElement){
		var comp = document.getElementById('comparator');
		var index = parseInt(currentElement.getAttribute("index"));
		
		//Removes previous compared listing
		
		if($('#comparator').length >= 1){
			var checkboxes = document.getElementsByClassName('checkitem');
			//alert(checkboxes.length);
			for(var i = 0; i < checkboxes.length; i+=1)
			{
				if(i!=index){
					checkboxes[i].childNodes[0].checked = false;
				}
			}
			
			comp.innerHTML = '';
		}
		if(currentElement.checked){
			showComparator();
			var listing = resultJSON.searchresult[index];
			
			var comp = document.getElementById('comparator');
			var image = document.createElement('img');
			image.setAttribute('src',listing.image);
			image.setAttribute('style','float:left;margin:10');
			comp.appendChild(image);
			var text = document.createElement('p');
			text.innerHTML = listing.name + '<br>' + listing.currency;
			
			comp.appendChild(text);
		}
		else{
			hideComparator();
		}
	}
	
	
	var resultJSON;

</script>
</head>
<body>
<h2 id="title">Bed Breakfast & Beyond</h2>
<a href="./index.html"> Enter another search </a>
<div id="result-container" style="position:relative">
	<div id="comparator">Comparator</div>
	<div id="div-my-tabl"></div>
</div>


<script>
$("document").ready(function() {
	
	$.getJSON("results.json", function(data) {
		resultJSON = data;
		$listings = data['searchresult'];
		var results = document.getElementById('div-my-tabl');
		var resultTable = document.createElement('table');
		results.appendChild(resultTable);
		$.each($listings, function(i, item) {
			var cell = document.createElement('td');
			var newDiv = document.createElement('div');
			newDiv.setAttribute('index', i);
			var innerHTML = '<div style=\"float:left\"><img src=\"' + item.image + '\"/></div>'; 
			innerHTML += 	'<h2 style=\"margin:0\">' + item.name + '</h2>';
			innerHTML += 	'<p style=\"margin:0\">     ' + item.room + '<br>' + item.currency + '</p>';
			innerHTML += 	'<div class=\"checkitem\" style=\"float:right\">' +
								'<input type=\"checkbox\" onclick=\"addToCompare(this)\"' +
								'index=\"' + i + '\"/>Compare' +
							'</div>';
			newDiv.innerHTML = innerHTML;
			cell.appendChild(newDiv);
			var tableRow = document.createElement('tr');
			tableRow.appendChild(cell);
			resultTable.appendChild(tableRow);
		});
	});
});
</script>

</body>
</html>